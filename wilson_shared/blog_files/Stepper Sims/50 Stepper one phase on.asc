Version 4
SHEET 1 7036 2004
WIRE 1216 -1312 1168 -1312
WIRE 832 -1264 832 -1344
WIRE 992 -1264 992 -1344
WIRE 1168 -1264 1168 -1312
WIRE 832 -1120 832 -1184
WIRE 992 -1120 992 -1184
WIRE 1168 -1120 1168 -1184
WIRE 5136 -896 4448 -896
WIRE 1360 -848 1360 -896
WIRE 5136 -784 4672 -784
WIRE 1104 -736 816 -736
WIRE 1360 -736 1360 -784
WIRE 1360 -736 1184 -736
WIRE 1472 -736 1360 -736
WIRE 1904 -736 1472 -736
WIRE 2112 -736 1984 -736
WIRE 1360 -688 1360 -736
WIRE 2112 -688 2112 -736
WIRE 2336 -672 2272 -672
WIRE 2576 -672 2480 -672
WIRE 2768 -672 2720 -672
WIRE 3168 -672 2912 -672
WIRE 3312 -672 3168 -672
WIRE 3808 -672 3456 -672
WIRE 4032 -672 3952 -672
WIRE 4224 -672 4176 -672
WIRE 4448 -672 4448 -896
WIRE 4448 -672 4368 -672
WIRE 4480 -672 4448 -672
WIRE 4672 -672 4672 -784
WIRE 4672 -672 4624 -672
WIRE 4704 -672 4672 -672
WIRE 4880 -672 4848 -672
WIRE 5120 -672 4880 -672
WIRE 1168 -656 1168 -688
WIRE 4336 -608 4336 -640
WIRE 4336 -608 4256 -608
WIRE 1120 -592 1120 -688
WIRE 816 -576 816 -736
WIRE 4336 -576 4336 -608
WIRE 4560 -576 4560 -608
WIRE 4880 -576 4880 -672
WIRE 4912 -576 4880 -576
WIRE 5120 -576 5056 -576
WIRE 1360 -560 1360 -624
WIRE 4784 -560 4784 -608
WIRE 1648 -544 1616 -544
WIRE 1872 -544 1792 -544
WIRE 2112 -544 2112 -608
WIRE 2112 -544 2016 -544
WIRE 2176 -544 2112 -544
WIRE 2416 -544 2416 -608
WIRE 3664 -528 3584 -528
WIRE 3744 -528 3664 -528
WIRE 3888 -528 3888 -608
WIRE 3888 -528 3824 -528
WIRE 4112 -512 4112 -608
WIRE 4352 -512 4112 -512
WIRE 5024 -512 5024 -544
WIRE 5024 -512 4944 -512
WIRE 1984 -480 1984 -512
WIRE 2176 -480 1984 -480
WIRE 3392 -480 3392 -608
WIRE 5024 -480 5024 -512
WIRE 1120 -464 1120 -512
WIRE 1728 -448 1728 -480
WIRE 1904 -448 1904 -480
WIRE 4160 -432 4112 -432
WIRE 4352 -432 4352 -512
WIRE 4352 -432 4304 -432
WIRE 2416 -400 2416 -464
WIRE 3584 -400 3584 -528
WIRE 2848 -384 2848 -608
WIRE 3888 -368 3888 -528
WIRE 4272 -368 4272 -400
WIRE 4272 -368 4192 -368
WIRE 3664 -352 3664 -528
WIRE 3840 -352 3664 -352
WIRE 512 -320 448 -320
WIRE 4272 -320 4272 -368
WIRE 2336 -304 2272 -304
WIRE 2656 -304 2656 -608
WIRE 2656 -304 2480 -304
WIRE 3840 -304 3808 -304
WIRE 1984 -288 1984 -480
WIRE 1984 -288 1424 -288
WIRE 3392 -288 3392 -400
WIRE 4112 -272 4112 -432
WIRE 4672 -272 4672 -672
WIRE 4672 -272 4112 -272
WIRE 448 -256 448 -320
WIRE 816 -256 816 -496
WIRE 1360 -256 1360 -336
WIRE 1424 -256 1424 -288
WIRE 2848 -256 2848 -304
WIRE 3808 -240 3808 -304
WIRE 3888 -240 3888 -288
WIRE 3888 -240 3808 -240
WIRE 1616 -224 1616 -544
WIRE 1616 -224 1520 -224
WIRE 3584 -192 3584 -320
WIRE 3888 -192 3888 -240
WIRE 1104 -160 816 -160
WIRE 1360 -160 1360 -192
WIRE 1360 -160 1184 -160
WIRE 1472 -160 1360 -160
WIRE 1904 -160 1472 -160
WIRE 2112 -160 1984 -160
WIRE 448 -144 448 -176
WIRE 1360 -128 1360 -160
WIRE 2112 -112 2112 -160
WIRE 1168 -80 1168 -112
WIRE 2416 -80 2416 -240
WIRE 2752 -48 2576 -48
WIRE 816 -16 816 -160
WIRE 1120 -16 1120 -112
WIRE 2752 0 2704 0
WIRE 1360 16 1360 -64
WIRE 1616 32 1616 -224
WIRE 1648 32 1616 32
WIRE 1872 32 1792 32
WIRE 2112 32 2112 -32
WIRE 2112 32 2016 32
WIRE 2176 32 2112 32
WIRE 2416 64 2416 0
WIRE 2576 80 2576 -48
WIRE 2704 80 2704 0
WIRE 1120 112 1120 64
WIRE 1984 112 1984 64
WIRE 2176 112 1984 112
WIRE 1728 128 1728 96
WIRE 1904 128 1904 96
WIRE 1984 224 1984 112
WIRE 1984 224 1440 224
WIRE 2576 224 2576 160
WIRE 2704 224 2704 160
WIRE 816 256 816 64
WIRE 1440 256 1440 224
FLAG 3168 -672 Torque
FLAG 2576 224 0
FLAG 2704 224 0
FLAG 2752 -48 sine
FLAG 2752 0 cosine
FLAG 1904 -448 0
FLAG 1728 -448 sine
FLAG 1904 128 0
FLAG 1728 128 cosine
FLAG 1520 -224 speed
FLAG 2416 64 0
FLAG 2272 -304 cosine
FLAG 2416 -400 0
FLAG 2272 -672 sine
FLAG 2848 -256 0
FLAG 832 -1120 0
FLAG 992 -1120 0
FLAG 832 -1344 +5v
FLAG 992 -1344 -5v
FLAG 1360 -896 +5v
FLAG 1360 -336 +5v
FLAG 1360 -560 -5v
FLAG 1360 16 -5v
FLAG 1424 -256 0
FLAG 1440 256 0
FLAG 1168 -1120 0
FLAG 1216 -1312 Vsample
FLAG 2176 -544 bemf_A
FLAG 2176 32 bemf_B
FLAG 2176 -480 bemf_A_ref
FLAG 2176 112 bemf_B_ref
FLAG 1472 -736 Va
FLAG 1472 -160 Vb
FLAG 816 256 0
FLAG 816 -256 0
FLAG 448 -144 0
FLAG 512 -320 Angle_in
FLAG 1168 -656 0
FLAG 1168 -80 0
FLAG 1120 -464 0
FLAG 1120 112 0
FLAG 3392 -288 0
FLAG 4784 -560 0
FLAG 4336 -576 0
FLAG 5136 -784 speed
FLAG 5120 -672 angle
FLAG 5136 -896 accel
FLAG 4272 -320 0
FLAG 5024 -480 0
FLAG 5120 -576 degrees
FLAG 4560 -576 0
FLAG 3584 -192 0
FLAG 3888 -192 0
SYMBOL res 2128 -592 R180
WINDOW 0 -51 61 Left 0
WINDOW 3 -51 25 Left 0
SYMATTR InstName R15
SYMATTR Value {Rs}
SYMBOL ind 1888 -720 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L2
SYMATTR Value {Ls}
SYMBOL bv 2576 64 R0
WINDOW 3 -421 108 Left 0
SYMATTR Value V=-K*sin((90/{step_angle})*V(angle))
SYMATTR InstName B5
SYMBOL bv 2704 64 R0
WINDOW 3 22 105 Left 0
SYMATTR Value V=K*cos((90/{step_angle})*V(angle))
SYMATTR InstName B6
SYMBOL Gain 1920 -576 R0
SYMATTR InstName E1
SYMATTR Value 1
SYMBOL Multiplier 1728 -544 R0
SYMATTR InstName X7
SYMBOL res 2128 -16 R180
WINDOW 0 -51 61 Left 0
WINDOW 3 -51 25 Left 0
SYMATTR InstName R1
SYMATTR Value {Rs}
SYMBOL ind 1888 -144 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value {Ls}
SYMBOL Gain 1920 0 R0
SYMATTR InstName E4
SYMATTR Value 1
SYMBOL Multiplier 1728 32 R0
SYMATTR InstName X8
SYMBOL bv 2416 -96 R0
SYMATTR InstName B1
SYMATTR Value V=I(L1)
SYMBOL Multiplier 2416 -304 R0
SYMATTR InstName X10
SYMBOL bv 2416 -560 R0
SYMATTR InstName B3
SYMATTR Value V=I(L2)
SYMBOL Multiplier 2416 -672 R0
SYMATTR InstName X11
SYMBOL Adder 2656 -672 R0
SYMATTR InstName X9
SYMBOL Adder 2848 -672 R0
SYMATTR InstName X12
SYMBOL bv 2848 -400 R0
WINDOW 3 -207 186 Left 0
SYMATTR Value V=-{Td}*sin((180/{step_angle})*V(angle))
SYMATTR InstName B2
SYMBOL diode 1376 -784 R180
WINDOW 0 24 72 Left 0
WINDOW 3 24 0 Left 0
SYMATTR InstName D1
SYMBOL diode 1376 -624 R180
WINDOW 0 24 72 Left 0
WINDOW 3 24 0 Left 0
SYMATTR InstName D2
SYMBOL diode 1376 -192 R180
WINDOW 0 24 72 Left 0
WINDOW 3 24 0 Left 0
SYMATTR InstName D3
SYMBOL diode 1376 -64 R180
WINDOW 0 24 72 Left 0
WINDOW 3 24 0 Left 0
SYMATTR InstName D4
SYMBOL voltage 832 -1280 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage 992 -1280 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value -5
SYMBOL voltage 1168 -1280 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -61 200 Left 0
SYMATTR Value PULSE(-1 1 0 0 0 {T_aperture} {1/(microsteps * freq)} 100000)
SYMATTR InstName V8
SYMBOL voltage 816 -32 R0
WINDOW 3 -428 106 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({-Vpeak} {Vpeak} 0 5E-6 5E-6 {0.5/freq} {1/freq} 1E6)
SYMATTR InstName V2
SYMBOL voltage 816 -592 R0
WINDOW 3 -463 102 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({Vpeak} {-Vpeak} {0.25/freq} 5E-6 5E-6 {0.5/freq} {1/freq} 1E6)
SYMATTR InstName V5
SYMBOL bv 448 -272 R0
SYMATTR InstName B4
SYMATTR Value V=pi*freq*time*step_angle/45
SYMBOL sw 1200 -736 M270
WINDOW 3 13 103 Left 0
SYMATTR Value VCS
SYMATTR InstName S1
SYMBOL sw 1200 -160 M270
WINDOW 3 13 103 Left 0
SYMATTR Value VCS
SYMATTR InstName S2
SYMBOL voltage 1120 -32 R0
WINDOW 3 -180 196 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(-1 1 {0.125/freq} 5E-6 5E-6 {0.25/freq} {0.5/freq} 1E6)
SYMATTR InstName V6
SYMBOL voltage 1120 -608 R0
WINDOW 3 -180 196 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(1 -1 {0.125/freq} 5E-6 5E-6 {0.25/freq} {0.5/freq} 1E6)
SYMATTR InstName V7
SYMBOL Subtractor 4112 -672 R0
SYMATTR InstName X1
SYMBOL Subtractor 3392 -672 R0
SYMATTR InstName X2
SYMBOL voltage 3392 -496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {TLoad}
SYMBOL Integrator 4784 -672 R0
SYMATTR InstName X3
SYMBOL Gain 4272 -704 R0
WINDOW 3 -85 -46 Left 0
SYMATTR Value {1/(Jmotor + Jload)}
SYMATTR InstName E2
SYMBOL Gain 4208 -464 R0
WINDOW 3 -12 32 Left 0
SYMATTR Value {Kd}
SYMATTR InstName E3
SYMBOL Gain 4960 -608 R0
WINDOW 3 -29 30 Left 0
SYMATTR Value {180/pi}
SYMATTR InstName E5
SYMBOL Integrator 4560 -672 R0
SYMATTR InstName X4
SYMBOL bv 3584 -416 R0
WINDOW 3 -202 269 Left 0
SYMATTR Value V={hardness}*(V(angle)-{limit})
SYMATTR InstName B7
SYMBOL Subtractor 3888 -672 R0
SYMATTR InstName X5
SYMBOL res 3840 -544 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL sw 3888 -384 R0
WINDOW 3 13 103 Left 0
SYMATTR Value VCS
SYMATTR InstName S3
TEXT 1992 -1944 Left 0 !.tran 0 5 0 uic
TEXT 1992 -1704 Left 0 !.param Jmotor = 3.5E-9
TEXT 1992 -1832 Left 0 !.param K = 0.004545
TEXT 2344 -1832 Left 0 ;Motor Constant K = Ke (Volts/(radian/sec)) = Kt (Newton-Meters/Amp)
TEXT 1992 -1800 Left 0 !.param Kd =120E-9
TEXT 2344 -1800 Left 0 ;Damping Torque (Newton-Meters/(radian/sec))
TEXT 1992 -1768 Left 0 !.param Rs = 227
TEXT 1992 -1736 Left 0 !.param Ls = 55E-3
TEXT 2344 -1704 Left 0 ;Rotational Inertia of motor shaft (Kilograms-Meter^2)
TEXT 2344 -1736 Left 0 ;Stator Coil Inductance (Henries)
TEXT 2344 -1768 Left 0 ;Stator Coil Resistance (Ohms)
TEXT 1992 -1672 Left 0 !.param Jload = 0
TEXT 2344 -1672 Left 0 ;Rotational Inertia of Motor Load (Kilograms-Meter^2)
TEXT 1624 -944 Left 0 ;STEPPER MOTOR
TEXT 1992 -1640 Left 0 !.param step_angle = 18
TEXT 2344 -1640 Left 0 ;Angle width of one full step (Degrees)
TEXT 1992 -1608 Left 0 !.param Td = 1E-6
TEXT 2344 -1608 Left 0 ;Detent Torque (Newton-Meters)
TEXT 2864 -584 Left 0 ;Detent Torque
TEXT 2456 -720 Left 0 ;Coil A Torque
TEXT 2664 -504 Left 0 ;Coil B Torque
TEXT 1992 -1216 Left 0 !.model VCS SW(Ron=1E-9 Roff=10T Vt=0)
TEXT 1768 -664 Left 0 ;COIL A
TEXT 1776 -72 Left 0 ;COIL B
TEXT 1992 -1576 Left 0 !.param Vpeak = 5
TEXT 2344 -1576 Left 0 ;Amplitude of drive (volts)
TEXT 1992 -1544 Left 0 !.param freq = 1
TEXT 2344 -1544 Left 0 ;Frequency of drive (Hz)
TEXT 1992 -1480 Left 0 !.param T_aperture 100E-9
TEXT 2344 -1480 Left 0 ;Sampling pulse width
TEXT 1992 -1512 Left 0 !.param microsteps = 64
TEXT 2344 -1512 Left 0 ;Number of microsteps per sinusoidal cycle
TEXT 1992 -1352 Left 0 !.param switch_freq = {freq*2}
TEXT 1992 -1320 Left 0 !.param switch_off = 100uS
TEXT 2344 -1352 Left 0 ;Frequency of switch pulse train
TEXT 2344 -1320 Left 0 ;Time that the switch is left open
TEXT 1992 -1416 Left 0 !.param limit = 2
TEXT 2344 -1416 Left 0 ;Hard stop position (radians)
TEXT 1992 -1384 Left 0 !.param hardness = 0.1
TEXT 2344 -1384 Left 0 ;Unitless factor which sets stop hardness.
TEXT 1992 -1448 Left 0 !.param Tload = 0
TEXT 2344 -1448 Left 0 ;Load torque (Newton-Meters)
TEXT 4368 -472 Left 0 ;Damping Torque
TEXT 3240 -960 Left 0 ;LOAD
TEXT 3424 -544 Left 0 ;Load Torque
TEXT 5240 -896 Left 0 ;radians/sec^2
TEXT 5256 -784 Left 0 ;radians/sec
TEXT 5248 -672 Left 0 ;radians
TEXT 1992 -1912 Left 0 !.options method = gear
TEXT 400 400 Left 0 ;D A V E    W I L S O N\nT E X A S    I N S T R U M E N T S
RECTANGLE Normal 3104 288 1568 -976
RECTANGLE Normal 5088 288 3232 -984
